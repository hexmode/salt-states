<?php
# vi set ai syntax=php

// Managed by Salt Stack, please DO NOT TOUCH, or ALL CHANGES WILL be LOST!

#error_reporting(0);

{% if salt['grains.get']('level') == 'staging' -%}
$siteTopLevelDomain = 'webplatformstaging.org';
{% else -%}
$siteTopLevelDomain = 'webplatform.org';
{% endif %}

#
# Redis job servers, managed by a Salt mine, network.ip_addrs at index 0
#
# To get the list, run from any salt minion:
#
#    salt-call mine.get 'roles:jobs' network.ip_addrs grain
#
$wpdRedisJobServers		= array();
{%- for minion,addrs in salt['mine.get']('roles:jobs', 'network.ip_addrs', expr_form='grain').items() %}
$wpdRedisJobServers[]		= '{{ addrs[0] }}';	// {{ minion }}
{%- endfor %}

#
# Redis session servers, managed by a Salt mine, network.ip_addrs at index 0
#
# To get the list, run from any salt minion:
#
#    salt-call mine.get 'roles:sessions' network.ip_addrs grain
#
$wpdRedisSessionServers		= array();
{%- for minion,addrs in salt['mine.get']('roles:sessions', 'network.ip_addrs', expr_form='grain').items() %}
$wpdRedisSessionServers[]	= '{{ addrs[0] }}:6379';	// {{ minion }}
{%- endfor %}

foreach(
  array_merge(
    glob( __DIR__ . '/../settings.d/*.php' ),
    glob( __DIR__ . "/../local.d/*.php" )
  ) as $conffile
) {
  include_once $conffile;
}

require_once( "$IP/../LocalSettings.php" );
require_once( "$IP/../../Settings.php" );
