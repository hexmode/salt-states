<VirtualHost *:80>
        ServerAdmin noc@webplatform.org
	ServerName docs.webplatform.org
  ServerAlias test.webplatform.org

        DocumentRoot /var/www

        <Directory />
                Options FollowSymLinks
                AllowOverride None
        </Directory>
        <Directory /var/www/>
                Options FollowSymLinks
                AllowOverride None
                Order allow,deny
                allow from all
        </Directory>

	<Directorymatch "^/.*/\.git/">
		Order deny,allow
		deny from all
	</Directorymatch>

	<FilesMatch "\.(ttf|otf|eot)$">
		<IfModule mod_headers.c>
		Header set Access-Control-Allow-Origin "*"
		</IfModule>
	</FilesMatch>

        ErrorLog syslog:local1

        # Possible values include: debug, info, notice, warn, error, crit,
        # alert, emerg.
        LogLevel warn

        CustomLog /var/log/apache2/access.log combined

	# MediaWiki
	<Directory /srv/webplatform/wiki/images>
		Options -Indexes
	</Directory>

	Alias /w/images /srv/webplatform/wiki/images
	Alias /w /srv/webplatform/wiki/current
	Alias /wiki /srv/webplatform/wiki/current/index.php
	Alias /t/images /srv/webplatform/wiki/testimages
	Alias /t /srv/webplatform/wiki/test
	Alias /test /srv/webplatform/wiki/test/index.php
	Alias /compat /srv/webplatform/compat

	RedirectMatch ^/docs(/)$ http://docs.webplatform.org/wiki/
	RedirectMatch ^/$ http://docs.webplatform.org/wiki/
        RedirectMatch permanent ^/wiki/(.+)/$ /wiki/$1

        # per http://lists.w3.org/Archives/Public/public-webplatform/2013Mar/0145.html
        RewriteEngine On
        RewriteCond %{HTTP_HOST}                         ^docs\.webplatform\.org$
        RewriteCond %{REQUEST_URI}                       !^/(wiki|w|test|t|compat)/
        RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} !-f
        RewriteRule ^(.*)$                               http://docs.webplatform.org/wiki$1   [R=301,L]
</VirtualHost>
