server {
    listen        80;
    server_name   _;
    server_tokens off;

    # ref: http://php.net/manual/en/install.fpm.configuration.php#pm.status-path
    location ~ ^/fcgi-(ping|status) {
        access_log     off;
        allow          127.0.0.1;
        allow          127.0.1.1;
        allow          10.10.10.0/24;
        deny           all;

        fastcgi_pass   {{ grains['ipaddr'] }}:9000;

        fastcgi_param   QUERY_STRING            $query_string;
        fastcgi_param   REQUEST_METHOD          $request_method;
        fastcgi_param   SCRIPT_FILENAME         $request_filename;
        fastcgi_param   SCRIPT_NAME             $fastcgi_script_name;
        fastcgi_param   REQUEST_URI             $request_uri;
    }

    # ref: http://nginx.org/en/docs/http/ngx_http_stub_status_module.html
    location /nginx-status {
        access_log     off;
        allow          127.0.0.1;
        allow          127.0.1.1;
        allow          10.10.10.0/24;
        deny           all;
        stub_status    on;
    }
}

# vim: ai ft=nginx tabstop=2 sw=2 noexpandtab:

